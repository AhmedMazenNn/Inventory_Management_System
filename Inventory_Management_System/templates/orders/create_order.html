{% extends "base/base.html" %}
{% load crispy_forms_tags %}

{% block content %}

<div class="container">
    <a href="{% url 'orders:order_list' %}" class="btn btn btn-outline-secondary fw-bold mt-3 w-25">All_Orders</a>
    <h1 class="mt-4 text-center">Create Order </h1>
    <hr>
    <form method="post" enctype="multipart/form-data" class="{{ form_class_name }}">
        {% csrf_token %}
        {% for field in form %}
        <div class="form-group">
            <label class="form-label fw-bold">{{field.label}}</label>
            {{field}}
            {% if field.errors %}
            <ul class="mt-2">
                {% for error in field.errors %}
                <li style="color: red;"> {{error}} </li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        {% endfor %}
        {% if form.non_field_errors %}
        <ul>
            {% for error in form.non_field_errors %}
            <li style="color: red;">{{error}}</li>
            {% endfor %}
        </ul>  
        {% endif %}
        <div class="d-flex justify-content-between align-items-center">
            <button type="submit" class="btn mt-4 w-25 " style="background-color: thistle;"> Add  </button>
            <a href="{% url 'orders:order_list' %}" class="btn btn-sm btn-secondary">cancel</a>
        </div>
    </form>
</div>

{% endblock content %}























<!-- <div class="container mt-4 text-center">
    <h1 class="fw-bold mb-3">Create Order</h1>
    <hr>
    <form method="post" form_class="OrderForm">
        {% csrf_token %}
        {{ order_form.as_p }}
        <h2 class="mt-4">Add Order Items</h2>
        <div class="row g-3 align-items-center mb-3">
            <div class="col-md-6">
                <label for="product" class="form-label">Product:</label>
                <select id="product" class="form-control">
                    <option value="" selected disabled>Select a product</option>
                    {% for product in products %}
                        <option value="{{ product.id }}" data-name="{{ product.name }}" data-quantity="{{ product.quantity }}" data-critical-quantity="{{ product.critical_quantity }}">
                            {{ product.name }} (Available: <p class="text-danger fw-bold">{{ product.quantity }}</p> )
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="quantity" class="form-label">Quantity:</label>
                <input type="number" id="quantity" class="form-control" min="1" value="1">
            </div>
            <div class="col-md-3">
                <button type="button" id="add-item" class="btn btn-success">Add Item</button>
            </div>
        </div>

        <h3 class="mt-4">Order Items</h3>
        <table class="table table-striped" id="order-items-table">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="order-items-body">
                <tr id="no-items">
                    <td colspan="4" class="text-center">No items added yet.</td>
                </tr>
            </tbody>
        </table>

        <input type="hidden" name="order_items" id="order-items-input">

        <button type="submit" class="btn btn-primary">Create Order</button>
    </form>
<<<<<<< HEAD
</div>

<script>
=======
</div> -->

<!-- <script>
>>>>>>> origin/Atyya
    let itemCount = 0;
    const orderItems = [];

    document.getElementById('add-item').addEventListener('click', function() {
        const productSelect = document.getElementById('product');
        const quantityInput = document.getElementById('quantity');
        const productId = productSelect.value;
        const productName = productSelect.options[productSelect.selectedIndex].dataset.name;
        const productQuantity = parseInt(productSelect.options[productSelect.selectedIndex].dataset.quantity);
        const productCriticalQuantity = parseInt(productSelect.options[productSelect.selectedIndex].dataset.criticalQuantity);
        const quantity = parseInt(quantityInput.value);

        if (!productId || quantity < 1) {
            alert('Please select a product and enter a valid quantity.');
            return;
        }

        // Check if the quantity will result in stock going below the critical quantity
        if (productQuantity - quantity < productCriticalQuantity) {
            alert(`Cannot add this item. The remaining stock will go below the critical quantity (${productCriticalQuantity}).`);
            return;
        }

        itemCount++;
        orderItems.push({ product_id: productId, quantity: quantity });

        const tableBody = document.getElementById('order-items-body');
        document.getElementById('no-items').style.display = 'none';

        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>${itemCount}</td>
            <td>${productName}</td>
            <td>${quantity}</td>
            <td><button type="button" class="btn btn-danger btn-sm remove-item">Remove</button></td>
        `;

        tableBody.appendChild(newRow);
        updateHiddenInput();

        newRow.querySelector('.remove-item').addEventListener('click', function() {
            newRow.remove();
            orderItems.splice(orderItems.findIndex(item => item.product_id === productId), 1);
            updateHiddenInput();
            if (orderItems.length === 0) {
                document.getElementById('no-items').style.display = '';
            }
        });

        productSelect.value = '';
        quantityInput.value = '1';
    });

    function updateHiddenInput() {
        document.getElementById('order-items-input').value = JSON.stringify(orderItems);
    }
</script>
<<<<<<< HEAD
{% endblock %}
=======
-->
>>>>>>> origin/Atyya
